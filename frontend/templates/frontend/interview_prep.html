{% extends "frontend/base.html" %}

{% block title %}AI Interview Prep{% endblock %}

{% block content %}
<style>
/* --- Typography & spacing tweaks --- */
.container { font-size: 1rem; }
.container > h2 { font-size: 2.25rem; font-weight: 800; letter-spacing: -0.5px; margin-bottom: 0.5rem; }
.card { padding: 0.6rem; border-radius: 12px; box-shadow: 0 1px 6px rgba(18,38,63,0.04); }
.card .card-body { padding: 0.85rem 1rem; }
.card h5, .card h6, .alert strong, .list-group-item strong { font-weight: 800; }
.text-primary { font-size: 1.05rem; font-weight: 700; }
.card + .card { margin-top: 0.6rem; }
.answer-box { font-size: 1rem; font-weight: 600; line-height: 1.25; padding: 0.5rem 0.6rem; resize: vertical; min-height: 64px; max-height: 140px; border-radius: 8px; }
.badge { font-size: 0.92rem; font-weight: 700; padding: 0.45rem 0.6rem; }
.btn { font-weight: 700; letter-spacing: -0.2px; }
.list-group-item { padding-top: 0.55rem; padding-bottom: 0.55rem; font-size: 0.97rem; }
.card-header.bg-light { padding: 0.45rem 0.75rem; border-bottom: 1px solid rgba(0,0,0,0.04); }
.collapse .card-body { padding: 0.6rem; }
@media (max-width: 576px) { .container > h2 { font-size: 1.6rem; } .answer-box { min-height: 56px; } }
/* Ensure the dropdown is not clipped */
.card-body select.form-select {
    z-index: 1050; /* higher than parent stacking */
}

</style>

<div class="container mt-5">
    <h2>ü§ñ AI-Powered Interview Preparation</h2>

    <!-- Job Selection -->
    <div class="card mt-4">
        <div class="card-body">
            <h2 class="mb-2">Select a Job Role to Practice</h2>
            <form method="GET" action="{% url 'interview_prep' %}" class="row g-3">
                {% csrf_token %}
                <div class="col-md-8">
                    <select name="job_id" class="form-select" required>
                        <option value="">-- Choose a Job Role --</option>
                        {% for j in jobs %}
                            <option value="{{ j.id }}" {% if job and job.id == j.id %}selected{% endif %}>{{ j.title }}</option>
                        {% endfor %}
                    </select>
                </div>
                <div class="col-md-4">
                    <button type="submit" class="btn btn-primary w-100">Generate Questions</button>
                </div>
            </form>
        </div>
    </div>

    {% if job %}
    <div class="alert alert-info mt-3">
        <strong>Selected Job:</strong> {{ job.title }}
    </div>
    {% endif %}

    {% if questions_data %}
    <div class="card mt-4">
        <div class="card-body">
            <h5 class="mb-2">üéØ Interview Questions for {{ job.title }}</h5>
            <p class="text-muted mb-3">AI-suggested answers and keywords to include in your responses</p>

            <div class="mt-3">
                {% for item in questions_data %}
                <div class="card mb-3 border">
                    <div class="card-header bg-light">
                        <h6 class="mb-0">Question {{ forloop.counter }}</h6>
                    </div>
                    <div class="card-body">
                        <h6 class="text-primary mb-2">‚ùì {{ item.question }}</h6>

                        <!-- Answer Practice Area -->
                        <div class="mt-2">
                            <label class="form-label"><strong>Your Answer:</strong></label>
                            <textarea class="form-control answer-box" rows="3"
                                      placeholder="Type your answer here..."
                                      data-index="{{ forloop.counter0 }}"></textarea>
                        </div>

                        <!-- AI Suggested Answer (Collapsible) -->
                        <div class="mt-3">
                            <button class="btn btn-outline-info btn-sm" type="button"
                                    data-bs-toggle="collapse"
                                    data-bs-target="#suggestedAnswer{{ forloop.counter }}"
                                    aria-expanded="false"
                                    aria-controls="suggestedAnswer{{ forloop.counter }}">
                                üí° Show AI Suggested Answer
                            </button>

                            <div class="collapse mt-2" id="suggestedAnswer{{ forloop.counter }}">
                                <div class="card card-body bg-light">
                                    <strong>AI Suggestion:</strong>
                                    <p class="mb-0">{{ item.suggested_answer|default:"No suggested answer available." }}</p>
                                </div>
                            </div>
                        </div>

                        <!-- Expected Keywords -->
                        {% if item.keywords %}
                        <div class="mt-3">
                            <strong>üéØ Keywords to Include:</strong>
                            <div class="mt-1">
                                {% for keyword in item.keywords %}
                                <span class="badge bg-success me-1 mb-1">{{ keyword }}</span>
                                {% endfor %}
                            </div>
                            <small class="text-muted">Try to incorporate these terms in your answer</small>
                        </div>
                        {% endif %}
                    </div>
                </div>
                {% endfor %}
            </div>

            <!-- Save Answers Button (Session Storage) -->
            <div class="mt-3">
                <button class="btn btn-success" onclick="saveAllAnswers()">üíæ Save Answers (Temporary)</button>
                <button class="btn btn-outline-danger ms-2" onclick="clearAllAnswers()">üóëÔ∏è Clear All</button>
                <small class="text-muted ms-2">Answers are saved in browser session only</small>
            </div>
        </div>
    </div>
    {% elif job %}
    <div class="alert alert-warning mt-4">
        ‚ùå No questions generated. Please check if you have a resume uploaded and try again.
    </div>
    {% endif %}

    <!-- Tips Section -->
    <div class="card mt-4">
        <div class="card-body">
            <h5 class="mb-2">üìù Interview Preparation Tips</h5>
            <ul class="list-group list-group-flush">
                <li class="list-group-item">‚Ä¢ <strong>Use the keywords</strong> - Incorporate the suggested keywords naturally in your answers</li>
                <li class="list-group-item">‚Ä¢ <strong>Practice aloud</strong> - Don't just write, speak your answers to build confidence</li>
                <li class="list-group-item">‚Ä¢ <strong>Time yourself</strong> - Aim for 2-3 minute answers for most questions</li>
                <li class="list-group-item">‚Ä¢ <strong>Use STAR method</strong> - Situation, Task, Action, Result for behavioral questions</li>
                <li class="list-group-item">‚Ä¢ <strong>Be specific</strong> - Use examples from your projects and experience</li>
            </ul>
        </div>
    </div>
</div>
{% endblock %}

{% block extra_js %}
<script>
// Save answers to session storage
function saveAllAnswers() {
    document.querySelectorAll('.answer-box').forEach((textarea, index) => {
        sessionStorage.setItem(`interview_answer_${index}`, textarea.value);
    });
    alert('Answers saved! They will be available until you close the browser.');
}

// Clear all answers
function clearAllAnswers() {
    document.querySelectorAll('.answer-box').forEach((textarea, index) => {
        textarea.value = '';
        sessionStorage.removeItem(`interview_answer_${index}`);
    });
}

// Load saved answers when page loads
document.addEventListener('DOMContentLoaded', function() {
    document.querySelectorAll('.answer-box').forEach((textarea, index) => {
        const saved = sessionStorage.getItem(`interview_answer_${index}`);
        if (saved) { textarea.value = saved; }

        // Auto-save on input
        textarea.addEventListener('input', function() {
            sessionStorage.setItem(`interview_answer_${index}`, this.value);
        });
    });
});
</script>
{% endblock %}
